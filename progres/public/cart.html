<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Keranjang - Simple E-Commerce</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <!-- HEADER -->
    <header class="bg-white shadow-sm p-3 mb-4">
      <div class="container d-flex justify-content-between">
        <h3 class="m-0">
          <i class="bi bi-shop text-primary me-2"></i>Simple E-Commerce
        </h3>

        <nav class="d-flex gap-3">
          <a href="index.html" class="text-dark">Beranda</a>
          <a href="cart.html" class="text-dark fw-bold">Keranjang</a>
          <a href="login.html" class="text-dark">Login</a>
        </nav>
      </div>
    </header>

    <div class="container">
      <h3 class="mb-3">Keranjang</h3>

      <div id="cart-empty" class="alert alert-info" style="display: none">
        Keranjang kosong
      </div>

      <div id="cart-table-wrapper" style="display: none">
        <table class="table table-bordered bg-white">
          <thead>
            <tr>
              <th>Produk</th>
              <th>Qty</th>
              <th>Harga</th>
              <th>Total</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="cart-body"></tbody>
        </table>

        <h4 id="grand-total" class="mt-3"></h4>

        <a href="checkout.html" class="btn btn-success mt-3">Checkout</a>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="text-center p-3 mt-4 bg-light">
      Â© 2025 Simple E-Commerce
    </footer>

    <script src="assets/js/add_to_cart.js"></script>

    <script>
      // --- Load cart from localStorage ---
      function getCart() {
        return JSON.parse(localStorage.getItem("cart")) || {};
      }

      function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      // --- Render Cart Table ---
      function renderCart() {
        const cart = getCart();
        const cartTable = document.getElementById("cart-table-wrapper");
        const cartEmpty = document.getElementById("cart-empty");
        const cartBody = document.getElementById("cart-body");
        const grandTotal = document.getElementById("grand-total");

        cartBody.innerHTML = "";
        let totalAll = 0;

        if (Object.keys(cart).length === 0) {
          cartTable.style.display = "none";
          cartEmpty.style.display = "block";
          return;
        }

        cartTable.style.display = "block";
        cartEmpty.style.display = "none";

        Object.values(cart).forEach((item) => {
          const total = item.price * item.qty;
          totalAll += total;

          cartBody.innerHTML += `
            <tr>
                <td>${item.name}</td>

                <td>
                    <input 
                        type="number"
                        class="form-control qty-input"
                        style="width:80px"
                        data-id="${item.id}"
                        min="1"
                        value="${item.qty}"
                    >
                </td>

                <td>Rp ${item.price.toLocaleString("id-ID")}</td>
                <td>Rp ${total.toLocaleString("id-ID")}</td>

                <td>
                    <button class="btn btn-danger btn-sm remove-btn" data-id="${
                      item.id
                    }">
                        Hapus
                    </button>
                </td>
            </tr>
        `;
        });

        grandTotal.innerHTML = `Total: Rp ${totalAll.toLocaleString("id-ID")}`;
      }

      // --- Update Quantity ---
      document.addEventListener("input", function (e) {
        if (e.target.classList.contains("qty-input")) {
          const id = e.target.dataset.id;
          const qty = parseInt(e.target.value);

          if (qty < 1) return;

          let cart = getCart();
          cart[id].qty = qty;
          saveCart(cart);

          renderCart();
          updateCartCount();
        }
      });

      // --- Remove item ---
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("remove-btn")) {
          const id = e.target.dataset.id;

          let cart = getCart();
          delete cart[id];
          saveCart(cart);

          renderCart();
          updateCartCount();
        }
      });

      // --- Initialize ---
      renderCart();
      updateCartCount();
    </script>
  </body>
</html>
