<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Checkout - Simple E-Commerce</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <!-- HEADER -->
    <header class="bg-white shadow-sm p-3 mb-4">
      <div class="container d-flex justify-content-between align-items-center">
        <h3 class="m-0">
          <i class="bi bi-shop me-2 text-primary"></i>Simple E-Commerce
        </h3>

        <nav class="d-flex gap-3">
          <a href="index.html" class="text-dark">Beranda</a>
          <a href="cart.html" class="text-dark">Keranjang</a>
          <a href="login.html" class="text-dark">Login</a>
        </nav>
      </div>
    </header>

    <div class="container">
      <h3 class="mb-3">Konfirmasi Checkout</h3>

      <!-- RINGKASAN ORDER -->
      <div
        id="order-summary"
        class="card shadow-sm p-3 mb-4"
        style="display: none"
      >
        <h5 class="mb-3">Ringkasan Belanja</h5>
        <ul id="order-items"></ul>
        <h4 class="mt-3">Total: <span id="order-total"></span></h4>
      </div>

      <!-- KOSONG -->
      <div id="empty-cart-alert" class="alert alert-info" style="display: none">
        Keranjang kosong. Silakan kembali ke halaman keranjang.
      </div>

      <!-- BUTTON -->
      <button id="submitCheckout" class="btn btn-success" style="display: none">
        Selesaikan Pesanan
      </button>
    </div>

    <!-- FOOTER -->
    <footer class="text-center p-3 mt-4 bg-light">
      Â© 2025 Simple E-Commerce
    </footer>

    <script src="assets/js/add_to_cart.js"></script>

    <script>
      // --- Ambil cart dari localStorage ---
      function getCart() {
        return JSON.parse(localStorage.getItem("cart")) || {};
      }

      // --- Simpan ke localStorage ---
      function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      // --- Render ringkasan checkout ---
      function renderCheckout() {
        const cart = getCart();
        const emptyAlert = document.getElementById("empty-cart-alert");
        const summaryBox = document.getElementById("order-summary");
        const submitBtn = document.getElementById("submitCheckout");
        const list = document.getElementById("order-items");
        const totalBox = document.getElementById("order-total");

        if (Object.keys(cart).length === 0) {
          emptyAlert.style.display = "block";
          summaryBox.style.display = "none";
          submitBtn.style.display = "none";
          return;
        }

        summaryBox.style.display = "block";
        submitBtn.style.display = "inline-block";

        list.innerHTML = "";
        let total = 0;

        Object.values(cart).forEach((item) => {
          const sum = item.price * item.qty;
          total += sum;

          list.innerHTML += `
            <li>${item.name} (x${item.qty}) - Rp ${sum.toLocaleString(
            "id-ID"
          )}</li>
        `;
        });

        totalBox.textContent = "Rp " + total.toLocaleString("id-ID");
      }

      // --- Ketika klik submit checkout ---
      document
        .getElementById("submitCheckout")
        .addEventListener("click", () => {
          // Simulasi membuat pesanan
          const cart = getCart();
          const orders = JSON.parse(localStorage.getItem("orders")) || [];

          const orderData = {
            id: Date.now(),
            items: cart,
            date: new Date().toLocaleString("id-ID"),
            total: Object.values(cart).reduce((t, i) => t + i.qty * i.price, 0),
            status: "Pending",
          };

          // Simpan ke riwayat pesanan
          orders.push(orderData);
          localStorage.setItem("orders", JSON.stringify(orders));

          // Kosongkan keranjang
          localStorage.removeItem("cart");
          updateCartCount();

          // Redirect ke daftar pesanan
          alert("Pesanan berhasil dibuat!");
          window.location.href = "my_orders.html";
        });

      // --- Init ---
      renderCheckout();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
