<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Detail Pesanan - Simple E-Commerce</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header class="bg-white shadow-sm p-3 mb-4">
      <div class="container d-flex justify-content-between align-items-center">
        <h3 class="m-0">
          <i class="bi bi-shop text-primary me-2"></i>Simple E-Commerce
        </h3>
        <nav class="d-flex gap-3">
          <a href="index.html" class="text-dark">Beranda</a>
          <a href="my_orders.html" class="text-dark">Pesanan Saya</a>
        </nav>
      </div>
    </header>

    <div class="container">
      <!-- HEADER PAGE -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h3 class="fw-bold mb-1" id="order-title">
            <i class="bi bi-receipt me-2"></i> Detail Pesanan
          </h3>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
              <li class="breadcrumb-item">
                <a href="index.html" class="text-decoration-none">Beranda</a>
              </li>
              <li class="breadcrumb-item">
                <a href="my_orders.html" class="text-decoration-none"
                  >Pesanan Saya</a
                >
              </li>
              <li class="breadcrumb-item active">Detail</li>
            </ol>
          </nav>
        </div>
      </div>

      <!-- ALERT jika order tidak ditemukan -->
      <div
        id="order-not-found"
        class="alert alert-danger d-flex align-items-center"
        style="display: none"
      >
        <i class="bi bi-exclamation-triangle me-2 fs-4"></i>
        <div><strong>Error!</strong> Pesanan tidak ditemukan.</div>
      </div>

      <div id="order-content" style="display: none">
        <div class="row g-4">
          <!-- ORDER INFO -->
          <div class="col-md-4">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                  <i class="bi bi-info-circle me-2"></i> Informasi Pesanan
                </h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <small class="text-muted d-block mb-1">
                    <i class="bi bi-hash me-1"></i> ID Pesanan
                  </small>
                  <span id="order-id" class="badge bg-primary fs-6"></span>
                </div>

                <div class="mb-3">
                  <small class="text-muted d-block mb-1">
                    <i class="bi bi-calendar-event me-1"></i> Tanggal Pesanan
                  </small>
                  <strong id="order-date"></strong><br />
                  <small id="order-time" class="text-muted"></small>
                </div>

                <hr />

                <div class="mb-3">
                  <small class="text-muted d-block mb-1">
                    <i class="bi bi-cash-coin me-1"></i> Total Pembayaran
                  </small>
                  <h4 id="order-total" class="text-success mb-0"></h4>
                </div>

                <div>
                  <small class="text-muted d-block mb-1">
                    <i class="bi bi-box-seam me-1"></i> Jumlah Item
                  </small>
                  <strong id="order-items-count"></strong>
                </div>
              </div>
            </div>
          </div>

          <!-- ORDER ITEM TABLE -->
          <div class="col-md-8">
            <div class="card shadow-sm">
              <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                  <i class="bi bi-cart-check me-2"></i> Produk dalam Pesanan
                </h5>
              </div>

              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover mb-0">
                    <thead class="table-light">
                      <tr>
                        <th class="px-4 py-3">Produk</th>
                        <th>Harga</th>
                        <th class="text-center">Qty</th>
                        <th class="text-end pe-4">Subtotal</th>
                      </tr>
                    </thead>

                    <tbody id="order-items-body"></tbody>

                    <tfoot class="table-light">
                      <tr>
                        <td colspan="3" class="px-4 py-3 text-end">
                          <strong>Total Pembayaran:</strong>
                        </td>
                        <td class="py-3 text-end pe-4">
                          <h5
                            id="order-total-footer"
                            class="text-success mb-0"
                          ></h5>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="text-center mt-4">
          <a href="my_orders.html" class="btn btn-secondary px-4">
            <i class="bi bi-arrow-left me-2"></i> Kembali ke Pesanan Saya
          </a>

          <button onclick="window.print()" class="btn btn-outline-primary px-4">
            <i class="bi bi-printer me-2"></i> Cetak Invoice
          </button>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="text-center p-3 mt-4 bg-light">
      Â© 2025 Simple E-Commerce
    </footer>

    <script>
      // Helper to get orders
      function getOrders() {
        return JSON.parse(localStorage.getItem("orders")) || [];
      }

      // Ambil ID dari URL
      const params = new URLSearchParams(window.location.search);
      const orderId = params.get("id");

      // Ambil data
      const orders = getOrders();
      const order = orders.find((o) => o.id == orderId);

      // Elemen HTML
      const notFound = document.getElementById("order-not-found");
      const content = document.getElementById("order-content");

      // Jika order tidak ditemukan
      if (!order) {
        notFound.style.display = "flex";
      } else {
        // Tampilkan content
        content.style.display = "block";

        // Set header title
        document.getElementById(
          "order-title"
        ).innerHTML = `<i class="bi bi-receipt me-2"></i> Detail Pesanan #${order.id}`;

        // Isi Informasi Pesanan
        document.getElementById("order-id").textContent = "#" + order.id;
        document.getElementById("order-date").textContent =
          order.date.split(",")[0];
        document.getElementById("order-time").textContent =
          order.date.split(",")[1] + " WIB";
        document.getElementById("order-total").textContent =
          "Rp " + order.total.toLocaleString("id-ID");
        document.getElementById("order-total-footer").textContent =
          "Rp " + order.total.toLocaleString("id-ID");
        document.getElementById("order-items-count").textContent =
          Object.keys(order.items).length + " Produk";

        // Render Item
        const body = document.getElementById("order-items-body");
        Object.values(order.items).forEach((it) => {
          const subtotal = it.price * it.qty;

          body.innerHTML += `
            <tr>
                <td class="px-4 py-3">
                    <strong>${it.name}</strong>
                </td>
                <td>Rp ${it.price.toLocaleString("id-ID")}</td>
                <td class="text-center">
                    <span class="badge bg-secondary">${it.qty}x</span>
                </td>
                <td class="text-end pe-4">
                    <strong class="text-success">
                        Rp ${subtotal.toLocaleString("id-ID")}
                    </strong>
                </td>
            </tr>
        `;
        });
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
